---
title: "First R code: MAF and MR calculation"
name: "Jinliang Yang"
date: 10-24-2023
output:
  word_document: default
  html_notebook: default
---

# Path normalization

Note that you have to learn how to use `markdown` for the text chunk

```{r}
knitr::opts_chunk$set(echo = TRUE) 
knitr::opts_knit$set(root.dir=normalizePath('../../')) 
```




```{r, eval=TRUE}
data <- read.csv("data/ng_rice_snp.csv")

#Calculating the missing rate
missing_count = rowSums(data[, -1] == "-") #adding all the occurances of "-" per each row.
total_individuals = ncol(data) - 1 #calculating number of individual samples we have.
missing_rate = missing_count / total_individuals
data$missing_rate = missing_rate#creating a new column missing rate back in sheet.

#calculating MAF
#creating a function to calculate MAF
calculate_maf = function(row) {
  #Exclude the marker name and missing data
  genotypes = row[!is.na(row) & row != "-"]
  #Count of each allele (each '1' counts as one of each allele, '0' and '2' count as two of one allele)
  ref_allele = sum(genotypes == 0) * 2 + sum(genotypes == 1)
  alt_allele = sum(genotypes == 2) * 2 + sum(genotypes == 1)
  #Total alleles
  total_alleles = ref_allele + alt_allele
  #Frequencies
  ref_freq = ref_allele / total_alleles
  alt_freq = alt_allele / total_alleles
  return(min(ref_freq, alt_freq)) #Return the minor allele frequency
}
#Appling the function to each row and store the result in the maf
maf = apply(data[, -1], 1, calculate_maf)  # excluding the first column with marker names and looping over each row.
data$maf = maf #updating new column with maf in excell sheet.
#Saving the data frame with the new 'missing_rate' and 'maf' columns to a new CSV file
write.csv(data, file = "cache/updated_ng_rice_snp.csv", row.names = FALSE, quote = FALSE, )

```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
